<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aida - ã‚°ãƒ«ãƒ¼ãƒ—</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Outfit:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                        heading: ['"Outfit"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .suggestions { 
            position: absolute; left: 0; right: 0; z-index: 9999; 
            background: white; border-radius: 12px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.15); 
            max-height: 200px; overflow-y: auto; display: none; 
        }
        .suggestions.show { display: block; }
        #map { height: 200px; border-radius: 12px; }
    </style>
</head>
<body class="font-sans bg-slate-50 text-slate-900 min-h-screen">
    <!-- Background -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute top-[-20%] right-[-10%] w-[500px] h-[500px] bg-indigo-500/20 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-[-20%] left-[-10%] w-[400px] h-[400px] bg-pink-500/20 rounded-full blur-[100px]"></div>
    </div>

    <!-- Header -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass border-b border-white/20 px-6 py-4">
        <div class="max-w-2xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-2xl font-black tracking-tighter bg-gradient-to-r from-indigo-500 to-pink-500 bg-clip-text text-transparent font-heading">Aida</a>
            <a href="index.html" class="text-sm text-slate-500 hover:text-indigo-500 transition-colors">ãƒˆãƒƒãƒ—ã¸</a>
        </div>
    </nav>

    <main class="relative z-10 max-w-2xl mx-auto px-4 pt-24 pb-12">
        <!-- æ–°è¦ä½œæˆç”»é¢ -->
        <div id="createView">
            <div class="glass-card p-8">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-r from-indigo-500 to-pink-500 text-white text-3xl mb-4">ğŸ‰</div>
                    <h1 class="text-2xl font-black text-slate-900 font-heading">æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</h1>
                    <p class="text-slate-500 mt-2">å¾…ã¡åˆã‚ã›å ´æ‰€ã‚’ã¿ã‚“ãªã§æ±ºã‚ã‚ˆã†</p>
                </div>
                <input type="text" id="groupName" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆä¾‹: å¿˜å¹´ä¼š2025ï¼‰" 
                    class="w-full px-5 py-4 rounded-xl border-2 border-slate-200 focus:border-indigo-500 focus:outline-none text-lg mb-4 transition-colors">
                <button onclick="createGroup()" 
                    class="w-full py-4 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 text-white font-bold text-lg shadow-lg shadow-indigo-500/25 hover:scale-[1.02] transition-transform">
                    ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ â†’
                </button>
            </div>
        </div>

        <!-- ã‚°ãƒ«ãƒ¼ãƒ—ç”»é¢ -->
        <div id="groupView" class="hidden space-y-6">
            <!-- URLå…±æœ‰ -->
            <div class="glass-card p-6">
                <h2 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">ğŸ“¤ ã“ã®URLã‚’å…±æœ‰</h2>
                <div class="bg-slate-100 rounded-xl p-4 mb-4">
                    <p id="shareUrl" class="text-sm text-slate-700 break-all font-mono"></p>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <button onclick="copyUrl()" class="py-3 rounded-xl bg-slate-900 text-white font-bold hover:bg-slate-800 transition-colors">
                        ğŸ“‹ ã‚³ãƒ”ãƒ¼
                    </button>
                    <button onclick="shareToLine()" class="py-3 rounded-xl bg-[#06C755] text-white font-bold hover:opacity-90 transition-opacity">
                        ğŸ’¬ LINE
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="shareToFacebook()" class="py-3 rounded-xl bg-[#1877F2] text-white font-bold hover:opacity-90 transition-opacity">
                        ğŸ“˜ Facebook
                    </button>
                    <button onclick="shareToInstagram()" class="py-3 rounded-xl bg-gradient-to-r from-[#833AB4] via-[#FD1D1D] to-[#F77737] text-white font-bold hover:opacity-90 transition-opacity">
                        ğŸ“· Instagram
                    </button>
                </div>
            </div>

            <!-- ãƒ¡ãƒ³ãƒãƒ¼ -->
            <div class="glass-card p-6">
                <h2 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">ğŸ‘¥ ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆ<span id="memberCount">0</span>äººï¼‰</h2>
                <div id="memberList" class="space-y-3 mb-4"></div>
                <button id="joinBtn" onclick="showJoinForm()" 
                    class="w-full py-4 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 text-white font-bold shadow-lg shadow-indigo-500/25 hover:scale-[1.02] transition-transform">
                    âœ‹ è‡ªåˆ†ã‚‚å‚åŠ ã™ã‚‹
                </button>
            </div>

            <!-- å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div id="joinForm" class="hidden glass-card p-6">
                <h2 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">ğŸ™‹ å‚åŠ æƒ…å ±ã‚’å…¥åŠ›</h2>
                <input type="text" id="nickname" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ " 
                    class="w-full px-5 py-4 rounded-xl border-2 border-slate-200 focus:border-indigo-500 focus:outline-none text-lg mb-4 transition-colors">
                
                <p class="text-sm font-bold text-slate-700 mb-2">ğŸš‰ ã‚ãªãŸã®å‡ºç™ºé§…ï¼ˆæœ€å¯„ã‚Šé§…ï¼‰</p>
                <p class="text-xs text-slate-400 mb-3">â€»ã“ã“ã‹ã‚‰ä¸­é–“åœ°ç‚¹ã‚’è¨ˆç®—ã—ã¾ã™</p>
                
                <label id="anywhereBtn" onclick="toggleAnywhere()" 
                    class="flex items-center gap-3 p-4 rounded-xl bg-amber-50 border-2 border-amber-200 cursor-pointer mb-4 hover:bg-amber-100 transition-colors">
                    <div id="checkboxIcon" class="w-6 h-6 rounded-md border-2 border-amber-400 flex items-center justify-center text-white text-sm font-bold"></div>
                    <span class="font-bold text-amber-700">ã©ã“ã§ã‚‚OKï¼ˆé§…ã‚’æŒ‡å®šã—ãªã„ï¼‰</span>
                </label>
                
                <div id="stationWrapper" class="relative mb-4">
                    <input type="text" id="stationInput" placeholder="å‡ºç™ºé§…ã‚’å…¥åŠ›ï¼ˆä¾‹: æ¸‹è°·ã€æ–°å®¿...ï¼‰" 
                        oninput="searchStation()" onfocus="searchStation()"
                        class="w-full px-5 py-4 rounded-xl border-2 border-slate-200 focus:border-indigo-500 focus:outline-none text-lg transition-colors">
                    <div id="suggestions" class="suggestions"></div>
                </div>
                
                <button onclick="joinGroup()" 
                    class="w-full py-4 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 text-white font-bold shadow-lg shadow-indigo-500/25 hover:scale-[1.02] transition-transform">
                    å‚åŠ ã™ã‚‹ â†’
                </button>
            </div>

            <!-- åœ°å›³ -->
            <div id="mapCard" class="hidden glass-card p-6">
                <h2 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">ğŸ—ºï¸ å€™è£œã‚¨ãƒªã‚¢</h2>
                <div id="map"></div>
            </div>

            <!-- å€™è£œ -->
            <div id="candidatesCard" class="hidden glass-card p-6">
                <h2 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">ğŸ—³ï¸ å€™è£œã«æŠ•ç¥¨ã—ã‚ˆã†</h2>
                <p class="text-xs text-slate-400 mb-4">ã‚¿ãƒƒãƒ—ã§æŠ•ç¥¨ãƒ»ã‚‚ã†ä¸€åº¦ã‚¿ãƒƒãƒ—ã§å–ã‚Šæ¶ˆã—</p>
                <div id="candidateList" class="space-y-4"></div>
            </div>
        </div>
    </main>
</body>
</html>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCxj6Qxk6PkL9WhbIQZh_wCwlhZBdY8MrQ",
    authDomain: "aida-f2eb3.firebaseapp.com",
    projectId: "aida-f2eb3",
    storageBucket: "aida-f2eb3.firebasestorage.app",
    messagingSenderId: "124876591098",
    appId: "1:124876591098:web:93bef3d94de8cf37799e43"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let groupId = null, groupData = null, myMemberId = null, isAnywhere = false, selectedStation = null, map = null;

const urlParams = new URLSearchParams(window.location.search);
groupId = urlParams.get('g');

if (groupId) {
    document.getElementById('createView').classList.add('hidden');
    document.getElementById('groupView').classList.remove('hidden');
    loadGroup();
}

async function createGroup() {
    const name = document.getElementById('groupName').value.trim() || 'æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—';
    const docRef = await db.collection('groups').add({
        name, members: [], candidates: [], votes: {},
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    groupId = docRef.id;
    window.history.pushState({}, '', `?g=${groupId}`);
    document.getElementById('createView').classList.add('hidden');
    document.getElementById('groupView').classList.remove('hidden');
    loadGroup();
}

function getShareUrl() {
    if (window.location.protocol === 'https:') return window.location.origin + '/app.html?g=' + groupId;
    return 'https://top-bay-three.vercel.app/app.html?g=' + groupId;
}

async function loadGroup() {
    document.getElementById('shareUrl').textContent = getShareUrl();
    db.collection('groups').doc(groupId).onSnapshot(doc => {
        if (doc.exists) { groupData = doc.data(); renderMembers(); checkAndShowCandidates(); }
    });
}

function renderMembers() {
    const list = document.getElementById('memberList');
    const members = groupData.members || [];
    document.getElementById('memberCount').textContent = members.length;
    
    if (members.length === 0) {
        list.innerHTML = '<p class="text-center text-slate-400 py-8">ã¾ã èª°ã‚‚å‚åŠ ã—ã¦ã„ã¾ã›ã‚“</p>';
    } else {
        list.innerHTML = members.map(m => `
            <div class="flex items-center gap-4 p-4 bg-white/50 rounded-xl">
                <div class="w-12 h-12 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 flex items-center justify-center text-white font-bold text-lg">${m.name.charAt(0)}</div>
                <div>
                    <p class="font-bold text-slate-900">${m.name}</p>
                    <p class="text-sm text-slate-500">${m.anywhere ? 'ğŸŒ ã©ã“ã§ã‚‚OK' : 'ğŸš‰ ' + m.station + 'é§…'}</p>
                </div>
            </div>
        `).join('');
    }
    
    const savedId = localStorage.getItem('aida_member_' + groupId);
    if (savedId && members.find(m => m.id === savedId)) {
        myMemberId = savedId;
        document.getElementById('joinBtn').classList.add('hidden');
        document.getElementById('joinForm').classList.add('hidden');
    }
}

function showJoinForm() {
    document.getElementById('joinForm').classList.remove('hidden');
    document.getElementById('joinBtn').classList.add('hidden');
}

function toggleAnywhere() {
    isAnywhere = !isAnywhere;
    const checkbox = document.getElementById('checkboxIcon');
    const wrapper = document.getElementById('stationWrapper');
    const btn = document.getElementById('anywhereBtn');
    
    if (isAnywhere) {
        checkbox.innerHTML = 'âœ“';
        checkbox.classList.add('bg-amber-400');
        wrapper.classList.add('hidden');
        btn.classList.add('bg-amber-100', 'border-amber-400');
    } else {
        checkbox.innerHTML = '';
        checkbox.classList.remove('bg-amber-400');
        wrapper.classList.remove('hidden');
        btn.classList.remove('bg-amber-100', 'border-amber-400');
    }
}

let searchTimeout = null;
function searchStation() {
    const query = document.getElementById('stationInput').value.trim();
    const suggestionsDiv = document.getElementById('suggestions');
    if (query.length < 1) { suggestionsDiv.classList.remove('show'); return; }
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(async () => {
        suggestionsDiv.innerHTML = '<div class="p-4 text-slate-400">æ¤œç´¢ä¸­...</div>';
        suggestionsDiv.classList.add('show');
        try {
            const res = await fetch(`https://express.heartrails.com/api/json?method=getStations&name=${encodeURIComponent(query)}`);
            const data = await res.json();
            if (data.response?.station) {
                const unique = [...new Map(data.response.station.map(s => [s.name + s.line, s])).values()];
                suggestionsDiv.innerHTML = unique.slice(0, 8).map(s => `
                    <div class="p-4 hover:bg-slate-50 cursor-pointer border-b border-slate-100" onclick="selectStation('${s.name}',${s.y},${s.x},'${s.line}')">
                        <p class="font-bold">${s.name}é§…</p>
                        <p class="text-sm text-slate-500">${s.line}ï¼ˆ${s.prefecture}ï¼‰</p>
                    </div>
                `).join('');
            } else { suggestionsDiv.innerHTML = '<div class="p-4 text-slate-400">è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>'; }
        } catch(e) { suggestionsDiv.innerHTML = '<div class="p-4 text-red-500">ã‚¨ãƒ©ãƒ¼</div>'; }
    }, 300);
}

function selectStation(name, lat, lng, line) {
    selectedStation = { name, lat, lng, line };
    document.getElementById('stationInput').value = name;
    document.getElementById('suggestions').classList.remove('show');
}

document.addEventListener('click', e => {
    if (!e.target.closest('#stationWrapper')) document.getElementById('suggestions').classList.remove('show');
});

async function joinGroup() {
    const name = document.getElementById('nickname').value.trim();
    if (!name) { alert('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
    if (!isAnywhere && !selectedStation) { alert('é§…ã‚’é¸æŠã™ã‚‹ã‹ã€Œã©ã“ã§ã‚‚OKã€ã‚’é¸ã‚“ã§ãã ã•ã„'); return; }
    
    const memberId = 'member_' + Date.now();
    const member = { id: memberId, name, anywhere: isAnywhere, station: isAnywhere ? null : selectedStation.name, lat: isAnywhere ? null : selectedStation.lat, lng: isAnywhere ? null : selectedStation.lng };
    
    await db.collection('groups').doc(groupId).update({ members: firebase.firestore.FieldValue.arrayUnion(member) });
    myMemberId = memberId;
    localStorage.setItem('aida_member_' + groupId, memberId);
    document.getElementById('joinForm').classList.add('hidden');
}

async function checkAndShowCandidates() {
    const members = groupData.members || [];
    const stationMembers = members.filter(m => !m.anywhere && m.lat && m.lng);
    if (stationMembers.length >= 2 && (!groupData.candidates || groupData.candidates.length === 0)) await calculateCandidates(stationMembers);
    if (groupData.candidates && groupData.candidates.length > 0) { renderCandidates(); renderMap(); }
}

async function calculateCandidates(stationMembers) {
    const avgLat = stationMembers.reduce((s, m) => s + m.lat, 0) / stationMembers.length;
    const avgLng = stationMembers.reduce((s, m) => s + m.lng, 0) / stationMembers.length;
    try {
        const res = await fetch(`https://express.heartrails.com/api/json?method=getStations&x=${avgLng}&y=${avgLat}`);
        const data = await res.json();
        if (data.response?.station) {
            let candidates = [...new Map(data.response.station.slice(0, 8).map(c => [c.name, c])).values()].slice(0, 5);
            candidates = candidates.map(c => ({ name: c.name, lat: parseFloat(c.y), lng: parseFloat(c.x), line: c.line }));
            const votes = {}; candidates.forEach(c => votes[c.name] = 0);
            await db.collection('groups').doc(groupId).update({ candidates, votes });
        }
    } catch(e) { console.error(e); }
}

function renderMap() {
    document.getElementById('mapCard').classList.remove('hidden');
    const candidates = groupData.candidates || [];
    if (candidates.length === 0) return;
    if (!map) {
        map = L.map('map').setView([candidates[0].lat, candidates[0].lng], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OpenStreetMap' }).addTo(map);
    }
    map.eachLayer(layer => { if (layer instanceof L.Marker) map.removeLayer(layer); });
    candidates.forEach((c, i) => {
        const icon = L.divIcon({ className: '', html: `<div style="background:linear-gradient(135deg,#6366f1,#ec4899);color:white;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px;box-shadow:0 2px 8px rgba(0,0,0,0.3);">${i+1}</div>`, iconSize: [28, 28] });
        L.marker([c.lat, c.lng], { icon }).addTo(map).bindPopup(`${c.name}é§…`);
    });
    map.fitBounds(L.latLngBounds(candidates.map(c => [c.lat, c.lng])), { padding: [30, 30] });
}

function renderCandidates() {
    document.getElementById('candidatesCard').classList.remove('hidden');
    const candidates = groupData.candidates || [];
    const votes = groupData.votes || {};
    const totalVotes = Object.values(votes).reduce((a, b) => a + b, 0) || 1;
    const myVote = localStorage.getItem('aida_vote_' + groupId);
    
    document.getElementById('candidateList').innerHTML = candidates.map((c, i) => {
        const voteCount = votes[c.name] || 0;
        const pct = Math.round((voteCount / totalVotes) * 100);
        const isVoted = myVote === c.name;
        return `
            <div class="p-5 rounded-2xl ${isVoted ? 'bg-green-50 border-2 border-green-400' : 'bg-white/60 border-2 border-transparent'} transition-all cursor-pointer hover:shadow-lg" onclick="vote('${c.name}')">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <span class="w-8 h-8 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 text-white flex items-center justify-center font-bold text-sm">${i+1}</span>
                        <span class="font-bold text-lg">${c.name}é§…</span>
                    </div>
                    <div class="flex gap-2">
                        ${i === 0 ? '<span class="px-3 py-1 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 text-white text-xs font-bold">ãŠã™ã™ã‚</span>' : ''}
                        ${voteCount > 0 ? `<span class="px-3 py-1 rounded-full bg-blue-100 text-blue-600 text-xs font-bold">${voteCount}ç¥¨</span>` : ''}
                    </div>
                </div>
                <p class="text-sm text-slate-500 mb-3">${c.line || ''}</p>
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-indigo-500 to-pink-500 transition-all" style="width:${pct}%"></div>
                    </div>
                    <span class="text-sm font-bold text-slate-500">${pct}%</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <a href="https://www.google.com/search?q=${encodeURIComponent(c.name + 'é§… å±…é…’å±‹ é£Ÿã¹ãƒ­ã‚°')}" target="_blank" onclick="event.stopPropagation()" class="py-3 rounded-xl bg-orange-500 text-white text-center font-bold text-sm hover:opacity-90">ğŸº é£Ÿã¹ãƒ­ã‚°</a>
                    <a href="https://www.google.com/maps/search/å±…é…’å±‹/@${c.lat},${c.lng},16z" target="_blank" onclick="event.stopPropagation()" class="py-3 rounded-xl bg-blue-500 text-white text-center font-bold text-sm hover:opacity-90">ğŸ—ºï¸ ãƒãƒƒãƒ—</a>
                </div>
            </div>
        `;
    }).join('');
}

async function vote(stationName) {
    const myVote = localStorage.getItem('aida_vote_' + groupId);
    const votes = { ...groupData.votes };
    if (myVote === stationName) { votes[stationName] = Math.max(0, (votes[stationName] || 0) - 1); localStorage.removeItem('aida_vote_' + groupId); }
    else if (myVote) { votes[myVote] = Math.max(0, (votes[myVote] || 0) - 1); votes[stationName] = (votes[stationName] || 0) + 1; localStorage.setItem('aida_vote_' + groupId, stationName); }
    else { votes[stationName] = (votes[stationName] || 0) + 1; localStorage.setItem('aida_vote_' + groupId, stationName); }
    await db.collection('groups').doc(groupId).update({ votes });
}

function copyUrl() { navigator.clipboard.writeText(getShareUrl()); alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼'); }

function shareToLine() {
    const name = groupData?.name || 'ã‚°ãƒ«ãƒ¼ãƒ—';
    window.open(`https://line.me/R/msg/text/?${encodeURIComponent(`ã€${name}ã€‘ã®å¾…ã¡åˆã‚ã›å ´æ‰€ã‚’æ±ºã‚ã‚ˆã†ï¼\n\n${getShareUrl()}`)}`, '_blank');
}

function shareToFacebook() {
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(getShareUrl())}`, '_blank', 'width=600,height=400');
}

function shareToInstagram() {
    navigator.clipboard.writeText(getShareUrl());
    // Instagramã‚¢ãƒ—ãƒªã®DMã‚’é–‹ãï¼ˆãƒ¢ãƒã‚¤ãƒ«ã®ã¿ï¼‰
    window.location.href = 'instagram://direct-inbox';
    setTimeout(() => {
        alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nInstagramã®DMã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
    }, 500);
}
</script>
